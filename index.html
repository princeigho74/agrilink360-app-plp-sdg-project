<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AgriLink360 — Pan-African Marketplace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const uid = (prefix='id') => prefix + '_' + Math.random().toString(36).slice(2,9);
const save = (k,v) => localStorage.setItem(k, JSON.stringify(v));
const load = (k, fallback) => { try { return JSON.parse(localStorage.getItem(k)) ?? fallback; } catch(e){ return fallback; } };

// African countries
const AFRICAN_COUNTRIES = ["Algeria","Angola","Benin","Botswana","Burkina Faso","Burundi","Cabo Verde","Cameroon","Central African Republic","Chad","Comoros","Congo (Brazzaville)","Congo (Kinshasa)","Djibouti","Egypt","Equatorial Guinea","Eritrea","Eswatini","Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau","Ivory Coast","Kenya","Lesotho","Liberia","Libya","Madagascar","Malawi","Mali","Mauritania","Mauritius","Morocco","Mozambique","Namibia","Niger","Nigeria","Rwanda","Sao Tome and Principe","Senegal","Seychelles","Sierra Leone","Somalia","South Africa","South Sudan","Sudan","Tanzania","Togo","Tunisia","Uganda","Zambia","Zimbabwe"];

// Demo products across Africa
const DEMO_PRODUCTS = [
  { id: 'p_rice', title: 'Rice', desc: 'Long grain rice', qty: '100 bags', price: 50, location: 'Lagos, Nigeria', temp: 26, humidity: 60, farmerId: 'f_igho', image:'https://raw.githubusercontent.com/princeigho74/images/main/farmer_igho.jpg', iot:'https://raw.githubusercontent.com/princeigho74/images/main/iot_monitor.jpg' },
  { id: 'p_beans', title: 'Beans', desc: 'Brown beans', qty: '200 bags', price: 45, location: 'Kano, Nigeria', temp: 28, humidity: 70, farmerId: 'f_lafikih', image:'https://raw.githubusercontent.com/princeigho74/images/main/farmer_lafikih.jpg', iot:'https://raw.githubusercontent.com/princeigho74/images/main/iot_monitor.jpg' },
  { id: 'p_cassava', title: 'Cassava', desc: 'Fresh cassava tubers', qty: '500kg', price: 30, location: 'Accra, Ghana', temp: 29, humidity: 85, farmerId: 'f_john', image:'https://raw.githubusercontent.com/princeigho74/images/main/farmer_john.jpg', iot:'https://raw.githubusercontent.com/princeigho74/images/main/iot_monitor.jpg' },
  { id: 'p_maize', title: 'Maize', desc: 'Yellow maize', qty: '300kg', price: 40, location: 'Nairobi, Kenya', temp: 27, humidity: 65, farmerId: 'f_lafikih', image:'https://raw.githubusercontent.com/princeigho74/images/main/farmer_lafikih.jpg', iot:'https://raw.githubusercontent.com/princeigho74/images/main/iot_monitor.jpg' },
  { id: 'p_yam', title: 'Yam', desc: 'Fresh yams', qty: '200kg', price: 35, location: 'Abuja, Nigeria', temp: 26, humidity: 60, farmerId: 'f_john', image:'https://raw.githubusercontent.com/princeigho74/images/main/farmer_john.jpg', iot:'https://raw.githubusercontent.com/princeigho74/images/main/iot_monitor.jpg' },
  { id: 'p_mango', title: 'Mango', desc: 'Sweet mangoes', qty: '150kg', price: 60, location: 'Cape Town, South Africa', temp: 25, humidity: 55, farmerId: 'f_igho', image:'https://raw.githubusercontent.com/princeigho74/images/main/farmer_igho.jpg', iot:'https://raw.githubusercontent.com/princeigho74/images/main/iot_monitor.jpg' },
  { id: 'p_cocoa', title: 'Cocoa', desc: 'Cocoa beans', qty: '400kg', price: 70, location: 'Ughelli, Delta, Nigeria', temp: 28, humidity: 75, farmerId: 'f_john', image:'https://raw.githubusercontent.com/princeigho74/images/main/farmer_john.jpg', iot:'https://raw.githubusercontent.com/princeigho74/images/main/iot_monitor.jpg' }
];

if(!localStorage.getItem('ag_products')) save('ag_products', DEMO_PRODUCTS);
if(!localStorage.getItem('ag_users')) save('ag_users', []);
if(!localStorage.getItem('ag_orders')) save('ag_orders', []);
if(!localStorage.getItem('ag_links')) save('ag_links', []);

// Header component
function Header({ current, setCurrent, user, onSignout }) {
  const [open, setOpen] = useState(false);
  const navButtons = [{key:'market', label:'Marketplace'}, {key:'iot', label:'IoT Monitor'}, {key:'contact', label:'Contact'}];
  if(user?.type==='farmer') navButtons.splice(1,0,{key:'fdashboard', label:'Farmer Dashboard'});
  navButtons.push({key:'auth', label:user?'Account':'Sign in / Register'});
  return (
    <header className="bg-white shadow sticky top-0 z-40">
      <div className="max-w-6xl mx-auto px-4 flex items-center justify-between h-16">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 rounded-md bg-green-600 text-white flex items-center justify-center font-bold">A</div>
          <div>
            <div className="font-semibold">AgriLink360</div>
            <div className="text-xs text-gray-500">Reducing Food Waste • Distributing Farm Produce • Feeding Communities</div>
          </div>
        </div>
        <div className="sm:hidden">
          <button aria-label="menu" onClick={()=>setOpen(!open)} className="p-2 border rounded">☰</button>
        </div>
        <nav className={`absolute sm:static left-0 top-16 sm:top-0 w-full sm:w-auto bg-white sm:bg-transparent p-4 sm:p-0 shadow sm:shadow-none ${open?'block':'hidden'} sm:block`}>
          <div className="flex flex-col sm:flex-row sm:items-center sm:gap-2">
            {navButtons.map(n=>(
              <button key={n.key} onClick={()=>{setCurrent(n.key); setOpen(false);}} className={`px-3 py-2 rounded text-left sm:text-center ${current===n.key?'bg-green-100':''}`}>{n.label}</button>
            ))}
            {user && (
              <div className="flex items-center gap-2 mt-3 sm:mt-0 sm:ml-4">
                <div className="text-sm">{user.name} <span className="text-xs text-gray-500">({user.type})</span></div>
                <button onClick={()=>{onSignout(); setOpen(false);}} className="px-3 py-1 border rounded text-sm">Sign out</button>
              </div>
            )}
          </div>
        </nav>
      </div>
    </header>
  );
}

// Auth component
function Auth({ onLogin }) {
  const [mode,setMode]=useState('login'); const [name,setName]=useState(''); const [email,setEmail]=useState(''); const [pw,setPw]=useState(''); const [type,setType]=useState('buyer');
  const usersKey='ag_users';
  function register(e){ e.preventDefault();
    if(!name||!email||!pw){alert('Fill all fields');return;}
    const users=load(usersKey,[]);
    if(users.some(u=>u.email===email)){alert('Email already registered');return;}
    const u={id:uid('u'), name,email,password:pw,type};
    users.push(u); save(users, usersKey); save(usersKey, users);
    alert('✅ Registration successful'); onLogin(u);
  }
  function login(e){ e.preventDefault(); const users=load(usersKey,[]); const u=users.find(x=>x.email===email&&x.password===pw); if(!u){alert('Invalid credentials'); return;} onLogin(u);}
  return (
    <div className="max-w-md mx-auto mt-8 p-6 bg-white rounded shadow">
      <h2 className="text-xl font-bold mb-4">{mode==='login'?'Login':'Register'}</h2>
      <form onSubmit={mode==='login'?login:register} className="space-y-3">
        {mode==='register'&&(<input value={name} onChange={e=>setName(e.target.value)} placeholder="Full name" className="w-full p-2 border rounded" />)}
        <input value={email} onChange={e=>setEmail(e.target.value)} type="email" placeholder="Email" className="w-full p-2 border rounded"/>
        <input value={pw} onChange={e=>setPw(e.target.value)} type="password" placeholder="Password" className="w-full p-2 border rounded"/>
        {mode==='register'&&(<select value={type} onChange={e=>setType(e.target.value)} className="w-full p-2 border rounded"><option value="buyer">Buyer</option><option value="farmer">Farmer</option></select>)}
        <button type="submit" className="w-full bg-green-600 text-white py-2 rounded">{mode==='login'?'Login':'Create Account'}</button>
      </form>
      <div className="mt-3 text-sm text-center">{mode==='login'? (<span>New user? <button onClick={()=>setMode('register')} className="text-green-600">Register</button></span>) : (<span>Already registered? <button onClick={()=>setMode('login')} className="text-green-600">Login</button></span>)}</div>
    </div>
  );
}

// Marketplace, Farmer Dashboard, IoT Monitor, Contact, App
// ... Keep the Marketplace, FarmerDashboard, IotMonitor, Contact code the same as previous full code
// Ensure to display product.image and product.iot in Farmer Dashboard and Marketplace cards

// Example snippet inside FarmerDashboard for images:
{/* <img src={p.image} alt="Farmer" className="w-full h-32 object-cover rounded mt-2"/>
<img src={p.iot} alt="IoT" className="w-full h-24 object-contain mt-1"/> */}

// Full App component
function App() {
  const [current,setCurrent]=useState('market'); const [user,setUser]=useState(load('ag_currentUser',null));
  useEffect(()=>window.addEventListener('storage',()=>setUser(load('ag_currentUser',null))),[]);
  function handleLogin(u){ setUser(u); save('ag_currentUser',u); if(u.type==='farmer') setCurrent('fdashboard'); else setCurrent('market');}
  function handleSignout(){ setUser(null); localStorage.removeItem('ag_currentUser'); setCurrent('market');}

  function handleBuy(p){ if(!user){ alert('Please sign in'); setCurrent('auth'); return;} if(user.type!=='buyer'){alert('Only buyers may purchase'); return;} alert(`✅ Bought ${p.title} (${p.qty}) for $${p.price}`); }
  function handleLinkWithFarmer(p){ if(!user){ alert('Sign in to link'); setCurrent('auth'); return;} const links=load('ag_links',[]); if(links.some(l=>l.farmerId===p.farmerId&&l.buyerId===user.id)){alert('Already linked');return;} links.push({farmerId:p.farmerId, buyerId:user.id}); save('ag_links',links); alert('✅ Successfully linked with farmer');}
  function handleView(p){ alert(`Product: ${p.title}\nDescription: ${p.desc}\nQuantity: ${p.qty}\nPrice: $${p.price}\nLocation: ${p.location}`); }

  return (
    <div>
      <Header current={current} setCurrent={setCurrent} user={user} onSignout={handleSignout}/>
      {current==='market' && <Marketplace user={user} onBuy={handleBuy} onLinkWithFarmer={handleLinkWithFarmer} onView={handleView}/>}
      {current==='fdashboard' && user?.type==='farmer' && <FarmerDashboard user={user}/>}
      {current==='iot' && <IotMonitor/>}
      {current==='contact' && <Contact/>}
      {current==='auth' && <Auth onLogin={handleLogin}/>}
    </div>
  );
}

ReactDOM.render(<App/>, document.getElementById('root'));
</script>
</body>
</html>
