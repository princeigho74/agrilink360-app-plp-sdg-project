<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AgriLink360 ‚Äî Pan-African Food Distribution</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://checkout.flutterwave.com/v3.js"></script>
</head>
<body class="bg-gray-50">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// ===================== UTILS =====================
const uid = (prefix='id') => prefix+'_'+Math.random().toString(36).slice(2,9);

// ===================== AFRICAN COUNTRIES =====================
const AFRICAN_COUNTRIES = [
  "Nigeria","Ghana","Kenya","Uganda","Senegal","Ethiopia","Cameroon",
  "South Africa","Tanzania","Morocco","Algeria","Egypt","Zimbabwe","Namibia",
  "Mali","Ivory Coast","Rwanda","Botswana","Zambia","Sudan","Tunisia","Libya",
  "Mauritius","Mozambique","Burundi","Gabon","Sierra Leone","Lesotho","Benin"
];

// ===================== PRODUCTS =====================
const PRODUCTS = [
  {id:1,title:"Rice",desc:"Long grain rice",qty:"100 bags",price:50,location:"Lagos, Nigeria",image:"https://i.imgur.com/7bV5VxP.jpg",sensor:{temp:26,humidity:60}},
  {id:2,title:"Beans",desc:"Brown beans",qty:"200 bags",price:45,location:"Kano, Nigeria",image:"https://i.imgur.com/n1xYjKX.jpg",sensor:{temp:28,humidity:70}},
  {id:3,title:"Cassava",desc:"Fresh cassava tubers",qty:"500kg",price:30,location:"Accra, Ghana",image:"https://i.imgur.com/PQjQxH7.jpg",sensor:{temp:29,humidity:85}},
  {id:4,title:"Onions",desc:"Red onions",qty:"100 bags",price:40,location:"Nairobi, Kenya",image:"https://i.imgur.com/VZpODsv.jpg",sensor:{temp:25,humidity:65}},
  {id:5,title:"Tomatoes",desc:"Fresh tomatoes",qty:"200 crates",price:35,location:"Kampala, Uganda",image:"https://i.imgur.com/4J9lJ3F.jpg",sensor:{temp:31,humidity:88}},
  {id:6,title:"Fish",desc:"Smoked fish",qty:"50 boxes",price:80,location:"Dakar, Senegal",image:"https://i.imgur.com/WrJX1p7.jpg",sensor:{temp:27,humidity:55}},
  {id:7,title:"Pepper",desc:"Chili pepper",qty:"70 bags",price:20,location:"Addis Ababa, Ethiopia",image:"https://i.imgur.com/VKtrK6C.jpg",sensor:{temp:30,humidity:75}},
  {id:8,title:"Garri",desc:"Ijebu garri",qty:"300 bags",price:25,location:"Abuja, Nigeria",image:"https://i.imgur.com/6gT0Y2F.jpg",sensor:{temp:26,humidity:60}},
  {id:9,title:"Bush Meat",desc:"Game meat",qty:"20 units",price:150,location:"Yaound√©, Cameroon",image:"https://i.imgur.com/XT1iPRg.jpg",sensor:{temp:28,humidity:77}},
];

// ===================== MARKETPLACE =====================
let trialCount = 0;
function Marketplace({onBuy,onView,query,setQuery}) {
  const [countryFilter,setCountryFilter] = useState('');

  const filtered = PRODUCTS.filter(p=>
    (p.title.toLowerCase().includes(query.toLowerCase()) ||
    p.location.toLowerCase().includes(query.toLowerCase())) &&
    (countryFilter ? p.location.includes(countryFilter) : true)
  );

  const handleBuy = (p) => {
    trialCount++;
    if(trialCount > 3){
      alert("‚ö†Ô∏è Free trial limit reached. Please proceed to payment.");
      return;
    }
    onBuy(p);
  };

  return (
    <div className="max-w-7xl mx-auto p-6">
      <h2 className="text-2xl font-bold text-green-700 mb-4">Marketplace</h2>
      <div className="flex flex-col sm:flex-row gap-2 mb-4">
        <input value={query} onChange={e=>setQuery(e.target.value)} placeholder="Search product..." className="border px-3 py-2 rounded flex-1"/>
        <select value={countryFilter} onChange={e=>setCountryFilter(e.target.value)} className="border px-3 py-2 rounded">
          <option value="">All Countries</option>
          {AFRICAN_COUNTRIES.map(c=><option key={c} value={c}>{c}</option>)}
        </select>
      </div>
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        {filtered.map(p=>(
          <div key={p.id} className="bg-white rounded shadow p-4">
            <img src={p.image} className="w-full h-40 object-cover rounded mb-2" />
            <h3 className="text-lg font-semibold">{p.title}</h3>
            <p className="text-sm text-gray-600">{p.desc}</p>
            <p className="text-xs text-gray-500">{p.qty} ‚Ä¢ {p.location}</p>
            <p className="mt-2 font-bold">${p.price}</p>
            <div className="mt-3 flex space-x-2">
              <button onClick={()=>handleBuy(p)} className="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">Buy</button>
              <button onClick={()=>onView(p)} className="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">View</button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// ===================== DASHBOARD =====================
function Dashboard(){
  const [orders,setOrders]=useState([
    {id:'A101',customer:'John Doe',quantity:10,status:'Delivered'},
    {id:'A102',customer:'Jane Smith',quantity:5,status:'Pending'},
    {id:'A103',customer:'Mark Lee',quantity:8,status:'In Transit'},
  ]);

  useEffect(()=>{
    const ctx=document.getElementById('ordersChart');
    if(ctx){
      new Chart(ctx,{
        type:'line',
        data:{
          labels:['Jan','Feb','Mar','Apr','May'],
          datasets:[{
            label:'Orders',
            data:[12,19,3,5,2],
            backgroundColor:'rgba(34,197,94,0.2)',
            borderColor:'rgba(34,197,94,1)',
            borderWidth:2,
            fill:true,
            tension:0.3
          }]
        },
        options:{responsive:true,maintainAspectRatio:false}
      });
    }
  },[]);

  return (
    <div className="p-4 space-y-6">
      <section className="bg-white p-6 rounded-lg shadow text-center">
        <h2 className="text-2xl font-bold text-green-700 mb-4">üåç AgriLink360 Dashboard</h2>
        <p className="text-gray-600">Smart farming insights and order monitoring</p>
      </section>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className="bg-white p-4 rounded shadow">
          <h2 className="text-gray-700 font-bold">Total Orders</h2>
          <p className="text-2xl font-bold">{orders.length}</p>
        </div>
        <div className="bg-white p-4 rounded shadow">
          <h2 className="text-gray-700 font-bold">Stock Level</h2>
          <p className="text-2xl font-bold">150</p>
        </div>
        <div className="bg-white p-4 rounded shadow">
          <h2 className="text-gray-700 font-bold">IoT Devices</h2>
          <p className="text-sm text-gray-700">Monitoring active devices</p>
        </div>
      </div>

      <div className="bg-white p-4 rounded shadow h-80">
        <canvas id="ordersChart"></canvas>
      </div>
    </div>
  );
}

// ===================== IoT MONITOR =====================
function IotMonitor(){
  const [iotData,setIotData]=useState(PRODUCTS.map(p=>({
    title:p.title,
    location:p.location,
    temp:p.sensor.temp,
    humidity:p.sensor.humidity
  })));
  const [countryFilter,setCountryFilter] = useState('');

  const filteredData = iotData.filter(d=> countryFilter ? d.location.includes(countryFilter) : true);

  return (
    <div className="max-w-7xl mx-auto p-6">
      <h2 className="text-2xl font-bold text-green-700 mb-4">IoT Monitor & Spoilage Alert</h2>
      <div className="flex gap-2 mb-4">
        <select value={countryFilter} onChange={e=>setCountryFilter(e.target.value)} className="border px-3 py-2 rounded">
          <option value="">All Countries</option>
          {AFRICAN_COUNTRIES.map(c=><option key={c} value={c}>{c}</option>)}
        </select>
      </div>
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        {filteredData.map(d=>(
          <div key={d.title} className={`p-4 rounded shadow ${d.temp>30?'bg-red-200':d.humidity>80?'bg-yellow-200':'bg-green-200'}`}>
            <h3 className="font-semibold">{d.title}</h3>
            <p className="text-sm text-gray-700">{d.location}</p>
            <p>üå°Ô∏è Temp: {d.temp}¬∞C</p>
            <p>üíß Humidity: {d.humidity}%</p>
            <p className="text-xs mt-1">
              {d.temp>30?'‚ö†Ô∏è High Temperature - Spoilage Risk':''}
              {d.humidity>80?' ‚ö†Ô∏è High Humidity':''}
            </p>
          </div>
        ))}
      </div>
    </div>
  );
}

// ===================== AUTH =====================
function Auth({onLogin}){
  const [mode,setMode]=useState('login');
  const [name,setName]=useState('');
  const [email,setEmail]=useState('');
  const [pw,setPw]=useState('');
  const [type,setType]=useState('farmer');

  const register=e=>{
    e.preventDefault();
    if(!name||!email||!pw){alert('Fill all fields');return;}
    const u={id:uid(type),name,email,password:pw,type};
    const users=JSON.parse(localStorage.getItem('users')||'[]');
    users.push(u);
    localStorage.setItem('users',JSON.stringify(users));
    onLogin(u);
  };

  const login=e=>{
    e.preventDefault();
    const users=JSON.parse(localStorage.getItem('users')||'[]');
    const u=users.find(x=>x.email===email && x.password===pw);
    if(!u){alert('Invalid credentials');return;}
    onLogin(u);
  };

  return (
    <div className="max-w-md mx-auto mt-10 bg-white p-6 rounded shadow">
      <h2 className="text-xl font-bold mb-4">{mode==='login'?'Login':'Register'}</h2>
      <form onSubmit={mode==='login'?login:register} className="space-y-3">
        {mode==='register' && (
          <input value={name} onChange={e=>setName(e.target.value)} placeholder="Full Name" className="w-full p-2 border rounded"/>
        )}
        <input value={email} onChange={e=>setEmail(e.target.value)} type="email" placeholder="Email" className="w-full p-2 border rounded"/>
        <input value={pw} onChange={e=>setPw(e.target.value)} type="password" placeholder="Password" className="w-full p-2 border rounded"/>
        {mode==='register' && (
          <select value={type} onChange={e=>setType(e.target.value)} className="w-full p-2 border rounded">
            <option value="farmer">Farmer</option>
            <option value="buyer">Buyer</option>
          </select>
        )}
        <button type="submit" className="w-full bg-green-600 text-white py-2 rounded">{mode==='login'?'Login':'Register'}</button>
      </form>
      <div className="mt-3 text-sm text-center">
        {mode==='login'?
          <span>New user? <button onClick={()=>setMode('register')} className="text-green-600">Register</button></span>:
          <span>Already registered? <button onClick={()=>setMode('login')} className="text-green-600">Login</button></span>}
      </div>
    </div>
  );
}

// ===================== CONTACT =====================
function Contact(){
  return (
    <div className="max-w-2xl mx-auto p-6 bg-white rounded shadow mt-6">
      <h2 className="text-2xl font-bold mb-4 text-green-700">Contact Us</h2>
      <p>Email: <a href="mailto:Smartxpress74@gmail.com" className="text-blue-600">Smartxpress74@gmail.com</a></p>
      <p className="mt-2">We provide Pan-African food distribution and smart farming solutions.</p>
    </div>
  );
}

// ===================== HEADER =====================
function Header({current,setCurrent,user,signout}){
  return (
    <header className="bg-white shadow sticky top-0 z-40">
      <div className="max-w-7xl mx-auto px-4 flex justify-between items-center h-16">
        <div className="flex items-center space-x-3">
          <div className="w-10 h-10 rounded-md bg-green-600 text-white flex items-center justify-center font-bold">A</div>
          <div>
            <div className="text-lg font-semibold">AgriLink360</div>
            <div className="text-xs text-gray-500">Food Distribution Across Africa</div>
          </div>
        </div>
        <nav className="flex items-center space-x-2">
          {['market','iot','dashboard','contact'].map(p=>(
            <button key={p} className={`px-3 py-2 rounded ${current===p?'bg-green-100':''}`} onClick={()=>setCurrent(p)}>
              {p==='market'?'Marketplace':p==='iot'?'IoT Monitor':p==='dashboard'?'Dashboard':'Contact'}
            </button>
          ))}
          {user ? (
            <div className="flex items-center gap-2">
              <span className="text-sm">{user.name}</span>
              <button onClick={signout} className="px-3 py-1 border rounded text-sm">Sign out</button>
            </div>
          ):(
            <button onClick={()=>setCurrent('auth')} className="px-3 py-1 border rounded text-sm">Sign in / Register</button>
          )}
        </nav>
      </div>
    </header>
  );
}

// ===================== APP ROOT =====================
function App(){
  const [current,setCurrent]=useState('market');
  const [user,setUser]=useState(null);
  const [query,setQuery]=useState('');
  const [selected,setSelected]=useState(null);

  return (
    <div>
      <Header current={current} setCurrent={setCurrent} user={user} signout={()=>setUser(null)} />
      {current==='auth' && <Auth onLogin={setUser} />}
      {current==='dashboard' && <Dashboard />}
      {current==='market' && <Marketplace query={query} setQuery={setQuery} onBuy={(p)=>alert("Bought "+p.title)} onView={setSelected} />}
      {current==='iot' && <IotMonitor />}
      {current==='contact' && <Contact />}

      {selected && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
          <div className="bg-white p-6 rounded shadow max-w-sm">
            <img src={selected.image} className="w-full h-40 object-cover rounded mb-2" />
            <h2 className="text-lg font-bold mb-2">{selected.title}</h2>
            <p>{selected.desc}</p>
            <p className="text-sm text-gray-600">{selected.qty} ‚Ä¢ {selected.location}</p>
            <p className="mt-2 font-bold">${selected.price}</p>
            <button onClick={()=>setSelected(null)} className="mt-4 bg-red-600 text-white px-3 py-1 rounded">Close</button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
